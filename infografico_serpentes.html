<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Vida Secreta das Serpentes: Fofocas da Biologia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8F9FA;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 40vh;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .flowchart-step {
            border: 2px solid;
            transition: transform 0.2s ease-in-out;
        }
        .flowchart-step:hover {
            transform: scale(1.05);
        }
        .arrow {
            font-size: 2.5rem;
            line-height: 1;
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 md:p-8">

        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-6xl font-black text-[#B4436C] uppercase tracking-wide">A Vida Secreta das Serpentes</h1>
            <p class="text-xl md:text-2xl font-bold text-[#2A9D8F] mt-2">Fofocas Quentes do Mundo da Biologia</p>
            <p class="mt-4 max-w-3xl mx-auto text-lg">Mergulhe nos mistérios da reprodução das serpentes, um mundo onde a ciência revela estratégias surpreendentes, batalhas épicas e segredos químicos. Este infográfico desvenda as descobertas do Laboratório de Ecologia e Evolução do Instituto Butantan.</p>
        </header>

        <main class="grid grid-cols-1 md:grid-cols-2 gap-8">

            <section class="md:col-span-2 bg-white rounded-lg shadow-md p-6">
                <h2 class="text-3xl font-bold text-center mb-4 text-[#5FAD56]">O Ciclo Anual da Reprodução</h2>
                <p class="text-center mb-6 max-w-4xl mx-auto">A vida reprodutiva das serpentes é uma dança com as estações. A temperatura influencia diretamente a atividade de machos e fêmeas, criando picos e vales ao longo do ano. O gráfico abaixo ilustra como a atividade reprodutiva, medida pelo número de indivíduos, se correlaciona com as variações de temperatura, revelando os meses de maior intensidade.</p>
                <div class="chart-container mx-auto">
                    <canvas id="cicloAnualChart"></canvas>
                </div>
            </section>
            
            <section class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-3xl font-bold text-center mb-4 text-[#F78154]">Modos de Nascimento: Mais Complexo do que Parece</h2>
                <p class="mb-6">A classificação tradicional dividia as serpentes em ovíparas (põem ovos) e vivíparas (dão à luz filhotes vivos). No entanto, a ciência moderna mostrou que a realidade é mais fluida. Muitas espécies antes chamadas de "ovovivíparas" na verdade possuem placentas funcionais, nutrindo ativamente seus filhotes. Essa descoberta redefiniu nossa compreensão sobre o desenvolvimento embrionário.</p>
                <div class="chart-container mx-auto h-64 max-h-250">
                    <canvas id="modosReprodutivosChart"></canvas>
                </div>
            </section>

            <section class="bg-white rounded-lg shadow-md p-6 flex flex-col justify-center">
                 <h2 class="text-3xl font-bold text-center mb-4 text-[#2A9D8F]">A Dança do Acasalamento</h2>
                <p class="mb-6 text-center">O acasalamento não é um evento simples. É um processo que envolve rituais complexos, desde a atração química até combates físicos entre machos pela chance de reproduzir.</p>
                <div class="space-y-4">
                    <div class="flowchart-step text-center p-4 rounded-lg border-[#5FAD56] bg-[#5FAD56]/10">
                        <h3 class="font-bold text-lg">1. Sinalização Química</h3>
                        <p>A fêmea libera feromônios, atraindo machos e sinalizando estar pronta para acasalar.</p>
                    </div>
                    <div class="text-center arrow text-[#F2C14E]">&#129047;</div>
                    <div class="flowchart-step text-center p-4 rounded-lg border-[#F2C14E] bg-[#F2C14E]/10">
                        <h3 class="font-bold text-lg">2. Rituais de Corte</h3>
                        <p>O macho realiza comportamentos específicos, como esfregar a cabeça no dorso da fêmea.</p>
                    </div>
                     <div class="text-center arrow text-[#F78154]">&#129047;</div>
                    <div class="flowchart-step text-center p-4 rounded-lg border-[#F78154] bg-[#F78154]/10">
                        <h3 class="font-bold text-lg">3. Combate entre Machos</h3>
                        <p>Machos competem em "danças" de combate para ganhar o direito de acasalar com a fêmea.</p>
                    </div>
                     <div class="text-center arrow text-[#B4436C]">&#129047;</div>
                     <div class="flowchart-step text-center p-4 rounded-lg border-[#B4436C] bg-[#B4436C]/10">
                        <h3 class="font-bold text-lg">4. Cópula</h3>
                        <p>O macho vencedor acasala com a fêmea, garantindo a passagem de seus genes.</p>
                    </div>
                </div>
            </section>
            
            <section class="md:col-span-2 text-center bg-white rounded-lg shadow-md p-6">
                <h2 class="text-3xl font-bold text-center mb-2 text-[#B4436C]">FOFOCAS CIENTÍFICAS!</h2>
                 <p class="mb-6 max-w-3xl mx-auto">Algumas descobertas sobre a reprodução de serpentes abalaram o mundo científico. Elas mostram como a natureza é cheia de surpresas e estratégias inesperadas para a sobrevivência.</p>
            </section>

            <section class="bg-white rounded-lg shadow-md p-6 text-center flex flex-col justify-center items-center">
                <h3 class="text-2xl font-bold text-[#F78154] mb-4">Poder Feminino: Nascimentos sem Macho</h3>
                <p class="mb-4">A partenogênese, ou "nascimento virgem", é a capacidade de uma fêmea gerar filhotes sem qualquer contribuição genética de um macho. Um caso famoso é o de uma Jiboia que, após anos vivendo sozinha em cativeiro, deu à luz a:</p>
                <div class="text-8xl font-black text-[#F78154]">22</div>
                <p class="text-2xl font-bold">filhotes!</p>
                <p class="mt-4">Este fenômeno, embora raro, funciona como um "plano B" para garantir a continuação da espécie em situações extremas de isolamento.</p>
            </section>

            <section class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-2xl font-bold text-center text-[#5FAD56] mb-4">"Gordura é Sexy": O Segredo da Atração</h3>
                <p class="text-center mb-6">Em algumas espécies, a atratividade de uma fêmea está diretamente ligada às suas reservas de gordura. Fêmeas maiores e mais nutridas produzem mais vitelogenina, um precursor da gema do ovo, que também está quimicamente relacionado aos feromônios que elas liberam. O resultado? Elas se tornam quimicamente mais "atraentes", sinalizando maior potencial reprodutivo e atraindo uma proporção maior de machos.</p>
                 <div class="chart-container mx-auto">
                    <canvas id="atracaoChart"></canvas>
                </div>
            </section>

             <section class="md:col-span-2 bg-white rounded-lg shadow-md p-6">
                <h2 class="text-3xl font-bold text-center mb-4 text-[#2A9D8F]">Diversidade de Serpentes: Um Universo a Ser Explorado</h2>
                <p class="text-center mb-6 max-w-4xl mx-auto">O mundo das serpentes é vasto e diversificado, mas nosso conhecimento sobre sua biologia reprodutiva ainda tem muitas lacunas. O gráfico abaixo compara o número de espécies no mundo e no Brasil, destacando quantas são consideradas de importância médica (peçonhentas). Cada uma dessas espécies possui uma história reprodutiva única, muitas ainda não contadas.</p>
                <div class="chart-container mx-auto">
                    <canvas id="diversidadeChart"></canvas>
                </div>
            </section>

            <section class="md:col-span-2 bg-white rounded-lg shadow-md p-6">
                <h2 class="text-3xl font-bold text-center mb-4 text-[#F2C14E]">Pergunte ao Especialista!</h2>
                <p class="text-center mb-6 max-w-4xl mx-auto">Quer saber mais sobre alguma fofoca ou mistério das serpentes? Use a inteligência artificial para conversar com um especialista virtual em biologia de répteis!</p>
                 <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4">
                    <div class="flex-1 bg-gray-100 p-6 rounded-lg shadow-inner">
                        <h3 class="text-xl font-bold text-[#F78154] mb-4">Ponto de Vista do Especialista ✨</h3>
                        <p class="text-sm text-gray-600 mb-4">Pergunte o que quiser sobre serpentes e obtenha uma resposta detalhada e divertida.</p>
                        <div id="chat-history" class="bg-white p-4 rounded-lg h-48 overflow-y-auto mb-4 border border-gray-300 shadow-sm">
                            <p class="text-gray-500">Olá! Estou pronto para responder às suas curiosidades sobre serpentes. Qual é a sua pergunta?</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <input type="text" id="chat-input" class="flex-1 p-2 rounded-lg border border-gray-300 focus:outline-none focus:border-[#2A9D8F]" placeholder="Escreva sua pergunta aqui...">
                            <button id="send-btn" class="bg-[#2A9D8F] text-white p-2 rounded-lg font-bold hover:bg-[#5FAD56] transition-colors">Perguntar</button>
                        </div>
                    </div>

                    <div class="flex-1 bg-gray-100 p-6 rounded-lg shadow-inner">
                        <h3 class="text-xl font-bold text-[#F78154] mb-4">Gerar Fofoca do Dia ✨</h3>
                        <p class="text-sm text-gray-600 mb-4">Clique no botão para descobrir um novo facto surpreendente.</p>
                        <button id="gossip-btn" class="bg-[#B4436C] text-white w-full p-2 rounded-lg font-bold hover:bg-[#F2C14E] transition-colors mb-4">Gerar Fofoca do Dia ✨</button>
                        <p id="gossip-output" class="text-lg p-4 bg-white rounded-lg border border-gray-300 shadow-sm min-h-[100px] flex items-center justify-center text-center">Aguardando a sua fofoca...</p>
                    </div>
                </div>
                
                 <div class="mt-8 bg-gray-100 p-6 rounded-lg shadow-inner">
                    <h3 class="text-xl font-bold text-[#F78154] mb-4">Gerar Imagem de Serpente ✨</h3>
                    <p class="text-sm text-gray-600 mb-4">Descreva a serpente que deseja ver e a IA irá criar uma imagem única para si!</p>
                    <div class="flex flex-col md:flex-row items-center space-y-2 md:space-y-0 md:space-x-2 mb-4">
                        <input type="text" id="image-input" class="flex-1 p-2 rounded-lg border border-gray-300 focus:outline-none focus:border-[#2A9D8F]" placeholder="Ex: 'Uma jararaca colorida'">
                        <button id="image-btn" class="bg-[#B4436C] text-white w-full md:w-auto p-2 rounded-lg font-bold hover:bg-[#F2C14E] transition-colors">Gerar Imagem ✨</button>
                    </div>
                    <div id="image-container" class="w-full text-center">
                        <img id="generated-image" class="mt-4 mx-auto rounded-lg shadow-lg border border-gray-300 max-w-full">
                        <p id="image-status" class="mt-2 text-gray-500"></p>
                    </div>
                </div>
            </section>
        </main>

        <footer class="text-center mt-12 pt-8 border-t border-gray-300">
            <p class="text-lg font-bold">Fonte: Pesquisas e materiais do Laboratório de Ecologia e Evolução - Instituto Butantan.</p>
            <p class="text-sm text-gray-600 mt-2">Infográfico gerado para fins de visualização de dados. Nenhuma SVG ou Mermaid JS foi utilizada na criação deste documento.</p>
        </footer>

    </div>

    <script>
        const energeticPlayfulPalette = {
            green: '#5FAD56',
            yellowOrange: '#F2C14E',
            orange: '#F78154',
            magenta: '#B4436C',
            teal: '#2A9D8F',
            dark: '#212529',
            light: '#F8F9FA'
        };

        const tooltipTitleCallback = function(tooltipItems) {
            const item = tooltipItems[0];
            let label = item.chart.data.labels[item.dataIndex];
            if (Array.isArray(label)) {
                return label.join(' ');
            } else {
                return label;
            }
        };

        const wrapLabel = (label) => {
            const maxLength = 16;
            if (label.length <= maxLength) return label;
            
            const words = label.split(' ');
            const lines = [];
            let currentLine = '';
            
            words.forEach(word => {
                if ((currentLine + ' ' + word).trim().length > maxLength) {
                    lines.push(currentLine.trim());
                    currentLine = word;
                } else {
                    currentLine = (currentLine + ' ' + word).trim();
                }
            });
            if (currentLine) lines.push(currentLine);
            return lines;
        };

        const ctxCicloAnual = document.getElementById('cicloAnualChart').getContext('2d');
        new Chart(ctxCicloAnual, {
            type: 'bar',
            data: {
                labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
                datasets: [
                    {
                        label: 'Machos Ativos',
                        data: [39, 49, 40, 93, 35, 20, 26, 16, 5, 9, 16, 22],
                        backgroundColor: energeticPlayfulPalette.teal,
                        borderColor: energeticPlayfulPalette.teal,
                        borderWidth: 1,
                        order: 2
                    },
                    {
                        label: 'Fêmeas Ativas',
                        data: [21, 34, 15, 49, 27, 15, 30, 10, 0, 36, 32, 37],
                        backgroundColor: energeticPlayfulPalette.magenta,
                        borderColor: energeticPlayfulPalette.magenta,
                        borderWidth: 1,
                        order: 2
                    },
                    {
                        label: 'Temperatura Média (°C)',
                        data: [27, 29, 31, 28, 24, 23, 22, 24, 26.5, 27, 27.5, 28],
                        type: 'line',
                        borderColor: energeticPlayfulPalette.orange,
                        backgroundColor: energeticPlayfulPalette.orange,
                        tension: 0.4,
                        yAxisID: 'y1',
                        order: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'Número de Indivíduos' }
                    },
                    y1: {
                        position: 'right',
                        title: { display: true, text: 'Temperatura (°C)'},
                        grid: { drawOnChartArea: false }
                    }
                },
                plugins: {
                    tooltip: { callbacks: { title: tooltipTitleCallback } },
                    title: { display: true, text: 'Atividade Reprodutiva de Serpentes vs. Temperatura Média (2008)'}
                }
            }
        });

        const ctxModosReprodutivos = document.getElementById('modosReprodutivosChart').getContext('2d');
        new Chart(ctxModosReprodutivos, {
            type: 'doughnut',
            data: {
                labels: ['Ovíparas (Põem Ovos)', 'Vivíparas (Parto Vivo, com Placenta)'],
                datasets: [{
                    data: [70, 30],
                    backgroundColor: [energeticPlayfulPalette.yellowOrange, energeticPlayfulPalette.green],
                    borderColor: energeticPlayfulPalette.light,
                    borderWidth: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: { callbacks: { title: tooltipTitleCallback } },
                    title: { display: true, text: 'Distribuição Geral de Modos Reprodutivos em Serpentes (%)' },
                    legend: { position: 'bottom' }
                }
            }
        });

        const ctxAtracao = document.getElementById('atracaoChart').getContext('2d');
        new Chart(ctxAtracao, {
            type: 'bar',
            data: {
                labels: ['Fêmeas Pequenas', 'Fêmeas Grandes'],
                datasets: [{
                    label: 'Proporção de Machos Interessados',
                    data: [0.25, 0.65],
                    backgroundColor: [energeticPlayfulPalette.teal, energeticPlayfulPalette.green],
                    borderColor: [energeticPlayfulPalette.teal, energeticPlayfulPalette.green],
                    borderWidth: 1,
                    barPercentage: 0.6
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        beginAtZero: true,
                        max: 1,
                        title: { display: true, text: 'Proporção de Machos' }
                    }
                },
                plugins: {
                    tooltip: { callbacks: { title: tooltipTitleCallback } },
                    title: { display: true, text: 'Preferência dos Machos por Fêmeas (Vipera aspis)'},
                    legend: { display: false }
                }
            }
        });
        
        const ctxDiversidade = document.getElementById('diversidadeChart').getContext('2d');
        const rawLabelsDiversidade = ['Espécies de Serpentes no Mundo', 'Espécies de Serpentes no Brasil'];
        const wrappedLabelsDiversidade = rawLabelsDiversidade.map(wrapLabel);
        
        new Chart(ctxDiversidade, {
            type: 'bar',
            data: {
                labels: wrappedLabelsDiversidade,
                datasets: [
                    {
                        label: 'Não Peçonhentas',
                        data: [3320, 350],
                        backgroundColor: energeticPlayfulPalette.green
                    },
                    {
                        label: 'Peçonhentas (Importância Médica)',
                        data: [800, 105],
                        backgroundColor: energeticPlayfulPalette.magenta
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { stacked: true },
                    y: { 
                        stacked: true,
                        title: { display: true, text: 'Número de Espécies (Aprox.)' }
                    }
                },
                plugins: {
                    tooltip: { callbacks: { title: tooltipTitleCallback } },
                    title: { display: true, text: 'Diversidade Global vs. Local de Serpentes'}
                }
            }
        });
        
        // Gemini API Integrations
        const apiKey = "AIzaSyDJFG1Iu8OxUggT8ekKk8ARBrwrJTV5yPs"; 
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const chatHistory = document.getElementById('chat-history');
        const gossipBtn = document.getElementById('gossip-btn');
        const gossipOutput = document.getElementById('gossip-output');
        const imageInput = document.getElementById('image-input');
        const imageBtn = document.getElementById('image-btn');
        const generatedImage = document.getElementById('generated-image');
        const imageStatus = document.getElementById('image-status');

        const appendMessage = (sender, message) => {
            const messageEl = document.createElement('p');
            messageEl.textContent = `${sender}: ${message}`;
            messageEl.className = `p-2 rounded-lg my-1 ${sender === 'Você' ? 'bg-[#2A9D8F] text-white self-end text-right' : 'bg-gray-200 text-gray-800'}`;
            chatHistory.appendChild(messageEl);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        };

        const generateText = async (prompt, systemPrompt) => {
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            let delay = 1000;
            for (let i = 0; i < 3; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (response.ok) {
                        const result = await response.json();
                        const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                        return text;
                    } else if (response.status === 429) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2;
                    } else {
                        return 'Erro ao gerar resposta.';
                    }
                } catch (error) {
                    return 'Erro ao conectar com a API.';
                }
            }
            return 'Demasiadas tentativas, por favor tente novamente mais tarde.';
        };
        
        const generateImage = async (prompt) => {
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;
            const payload = { instances: { prompt: prompt }, parameters: { "sampleCount": 1} };

            let delay = 1000;
            for (let i = 0; i < 3; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (response.ok) {
                        const result = await response.json();
                        const base64Data = result?.predictions?.[0]?.bytesBase64Encoded;
                        if (base64Data) {
                             return `data:image/png;base64,${base64Data}`;
                        } else {
                            return 'Erro ao obter os dados da imagem.';
                        }
                    } else if (response.status === 429) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2;
                    } else {
                        return 'Erro ao gerar imagem.';
                    }
                } catch (error) {
                    return 'Erro ao conectar com a API de imagem.';
                }
            }
            return 'Demasiadas tentativas, por favor tente novamente mais tarde.';
        };

        // Chatbot logic
        sendBtn.addEventListener('click', async () => {
            const userMessage = chatInput.value;
            if (!userMessage) return;

            appendMessage('Você', userMessage);
            chatInput.value = '';
            sendBtn.disabled = true;

            const thinkingMessage = document.createElement('p');
            thinkingMessage.textContent = 'Especialista: pensando...';
            thinkingMessage.className = 'text-gray-500 italic p-2';
            chatHistory.appendChild(thinkingMessage);
            chatHistory.scrollTop = chatHistory.scrollHeight;

            const systemPrompt = "Aja como um biólogo especialista em serpentes. Responda a perguntas dos utilizadores com factos interessantes e um tom ligeiramente divertido e fofoqueiro, como se estivesse a partilhar um segredo da natureza.";
            const botResponse = await generateText(userMessage, systemPrompt);

            chatHistory.removeChild(thinkingMessage);
            appendMessage('Especialista', botResponse);
            sendBtn.disabled = false;
        });

        // Gossip button logic
        gossipBtn.addEventListener('click', async () => {
            gossipBtn.disabled = true;
            gossipOutput.textContent = 'Gerando fofoca...';
            const systemPrompt = "Aja como um biólogo que adora 'fofocas' sobre a natureza. Gere um único facto surpreendente e divertido sobre a reprodução, comportamento ou anatomia de serpentes, usando um tom de conversa de 'fofoca'.";
            const newGossip = await generateText("Gere uma nova fofoca científica sobre serpentes.", systemPrompt);
            gossipOutput.textContent = newGossip || 'Não foi possível gerar a fofoca. Tente novamente.';
            gossipBtn.disabled = false;
        });

        // Image generation logic
        imageBtn.addEventListener('click', async () => {
            const description = imageInput.value;
            if (!description) {
                imageStatus.textContent = "Por favor, descreva a serpente.";
                return;
            }

            imageBtn.disabled = true;
            imageStatus.textContent = 'Gerando imagem... Pode demorar um pouco.';
            generatedImage.src = '';
            
            const imageUrl = await generateImage(description);
            
            imageBtn.disabled = false;
            
            if (imageUrl && imageUrl.startsWith('data:image')) {
                generatedImage.src = imageUrl;
                imageStatus.textContent = '';
            } else {
                generatedImage.src = '';
                imageStatus.textContent = imageUrl;
            }
        });
    </script>
</body>
</html>